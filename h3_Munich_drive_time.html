
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Munich Drive Time from Center</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
.mapboxgl-ctrl-logo {
    display: none !important;
}
.mapbox-improve-map {
    display: none;
}
.mapboxgl-popup-content{
    color:  white;
    background: #919191;
}
.mapboxgl-popup-anchor-top .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
    border-bottom-color: #919191;
}
.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip,
.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
    border-top-color: #919191;
}
.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
    border-right-color: #919191;
}
.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
    border-left-color: #919191;
}
.legend {
background-color: #fff;
border-radius: 3px;
bottom: 30px;
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
padding: 10px;
position: absolute;
right: 10px;
z-index: 1;
}
.legend h4 {
margin: 0 0 10px;
}
.legend div span {
border-radius: 50%;
display: inline-block;
height: 10px;
margin-right: 5px;
width: 10px;
}
</style>
</head>
<body>
<div id="map"></div>

<div id="line-legend" class="legend">
<h4>Shortest Driving Time<br>from Center [min.]</h4>
<div><span style="background-color: #F7F4F9"></span> < 3.5</div>
<div><span style="background-color: #DCC9E2"></span>3.5 - 6</div>
<div><span style="background-color: #D08AC2"></span>6 - 9</div>
<div><span style="background-color: #E33890"></span>9 -12</div>
<div><span style="background-color: #B70B4F"></span>12 - 15</div>
<div><span style="background-color: #67001F"></span> > 15</div>
</div>

<script>
    mapboxgl.accessToken = "pk.eyJ1IjoiaWRvbG8iLCJhIjoiY2psZG92bmRnMGJwMzN3bXE0NHhqNXB3eiJ9.o4pun6ru5RRIJxGUlldPJA";
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        center: [11.573977, 48.133],
        zoom: 13,
        pitch: 40
    });

    map.on('load', () => {

        map.addSource("h3-hexagons", {
          type: "geojson",
          data: './data/h3_Munich_radial_drive_time.geojson'
        });
        map.addLayer({
          id: "h3-fill",
          type: "fill",
          source: "h3-hexagons",
          paint: {
            "fill-color": [
              "step",
              ["get", "driving_time"],
              "#F7F4F9",
              3.5, "#DCC9E2",
              6,   "#D08AC2",
              9,   "#E33890",
              12,  "#B70B4F",
              15,  "#67001F",
            ],
            "fill-opacity": 0.3
          }
        });      

        map.addLayer({
          id: "h3-outline",
          type: "line",
          source: "h3-hexagons",
          paint: {
            "line-color": "#444",
            "line-width": 0.5
          }
        });  

        // Add a popup on hover
        const popup = new mapboxgl.Popup({
          closeButton: false,
          closeOnClick: false
        });
        map.on("mousemove", "h3-fill", (e) => {
          const v = e.features[0].properties.driving_time;

          popup
            .setLngLat(e.lngLat)
            .setHTML(`<b>Driving Time: </b><br> ${Number(v).toFixed(1)} min`)
            .addTo(map);
        });

        map.on("mouseleave", "h3-fill", () => {
          popup.remove();
        });

        map.addLayer({
            'id': '3d-buildings',
            'source': 'composite',
            'source-layer': 'building',
            'filter': ['==', 'extrude', 'true'],
            'type': 'fill-extrusion',
            'minzoom': 15,
            'paint': {
                'fill-extrusion-color': '#aaa',

                // use an 'interpolate' expression to add a smooth transition effect to the
                // buildings as the user zooms in
                'fill-extrusion-height': [
                    'interpolate',
                    ['linear'],
                    ['zoom'],
                    15,
                    0,
                    15.05,
                    ['get', 'height']
                ],
                'fill-extrusion-base': [
                    'interpolate',
                    ['linear'],
                    ['zoom'],
                    15,
                    0,
                    15.05,
                    ['get', 'min_height']
                ],
                'fill-extrusion-opacity': 0.6
            }
        });
    });
</script>

</body>
</html>    
